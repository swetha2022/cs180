<!DOCTYPE html>
<html>
<head>
    <title>Project 1</title>
    <style>
        body {
            font-family: Georgia, sans-serif;
            /* margin: 20px; */
            text-align: center;  
        }
        .flex-center {
            display: flex;
            justify-content: center; 
            gap: 20px;
            flex-wrap: wrap; 
            margin-top: 10px;
            margin-bottom: 20px;
        }
        figure {
            margin: 0;
        }
        figcaption {
            text-align: center;
            margin-top: 5px;
        }
        
        p {
            text-align: left;
            max-width: 1300px;   /* crops the text width */
            margin-left: 170px;  /* pushes in slightly from page edge */
            margin-right: auto; /* makes it not centered */
        }
    </style>
</head>
<body>
    <h1>Project 1: Images of the Russian Empire -- Colorizing the Prokudin-Gorskii Photo Collection</h1>
    <h3>Webpage Link: <a href="https://swetha2022.github.io/cs180/1/index.html">https://swetha2022.github.io/cs180/1/index.html</a></h3>

    <h2>Introduction</h2>
    <p style="text-align: left; max-width: 800px; margin-left: 100">In this project, I applied various image processing techniques to align digitized Prokudin-Gorskii glass plate images into a single RGB color image. I first implemented a naive algorithm that exhaustively searched within a predefined displacement window, selecting the offsets that produced the best score based on Euclidean distance and Normalized Cross-Correlation (NCC) when aligning the R and G plates to the B plate. While effective, this method was slow for larger image files and often produced blurry alignments on these images. To address this, I implemented an image pyramid that represented the image at multiple resolutions and applied the same search procedure recursively, moving from the coarsest to the finest scale with smaller displacement windows. This approach produced better alignments for large images and reduced processing time for each image to under one minute.</p>

    <h2>Part 1: Simple Alignment</h2>
    <p>In this part, I implemented a naive algorithm to align the R and G plates with the B plate using both Euclidean distance and Normalized Cross-Correlation (NCC). The algorithm worked as follows: I performed an exhaustive search over a displacement window ranging from -15 to 15 in both the x and y directions, shifting the R and G plates relative to the B plate using <code>np.roll()</code>. For each displacement, I computed a score based on either Euclidean distance or NCC between the shifted plate and the B plate. To prevent the borders from introducing noise into the results, I cropped 10% from each side of the plates and only used the cropped regions when computing the scores. The displacement that produced the best score was selected as the optimal alignmentâ€”first between the G and B plates, and then between the R and B plates. Overall, NCC yielded more accurate alignments than Euclidean distance, especially for images with significant variations in brightness and contrast.</p>

    <p style="text-align: left;">Below are several examples of images aligned using this method with NCC as the scoring metric.</p>

    <div class="flex-center">
        <figure style="width: 25%;">
            <img src="./outputs_pyramid/ncc/cathedral.jpg" alt="Error" style="width: 100%;">
            <figcaption>
                <p>Green X-Y Displacement: (5, 2)</p>
                <p>Red X-Y Displacement: (12, 3)</p>
                <p>Time Taken: 0.88 seconds</p>
            </figcaption>
        </figure>
        <figure style="width: 25%;">
            <img src="./outputs_simple/ncc/monastery.jpg" alt="Error" style="width: 100%;">
            <figcaption>
                <p>Green X-Y Displacement: (-3, 2)</p>
                <p>Red X-Y Displacement: (3, 2)</p>
                <p>Time Taken: 0.91 seconds</p>
            </figcaption>
        </figure>
        <figure style="width: 25%;">
            <img src="./outputs_simple/ncc/tobolsk.jpg" alt="Error" style="width: 100%;">
            <figcaption>
                <p>Green X-Y Displacement: (3, 3)</p>
                <p>Red X-Y Displacement: (6, 3)</p>
                <p>Time Taken: 0.93 seconds</p>
            </figcaption>
        </figure>
    </div>

    <p style="text-align: left;">For larger .tif files, the algorithm runs slowly and produces blurry alignments as seen below, motivating the need for optimization.</p>

    <div class="flex-center">
        <figure style="width: 25%;">
            <img src="./outputs_simple/ncc/church.jpg" alt="Error" style="width: 100%;">
            <figcaption>
                <p>Green X-Y Displacement: (15, 4)</p>
                <p>Red X-Y Displacement: (15, -14)</p>
                <p>Time Taken: 156.35 seconds</p>
            </figcaption>
        </figure>
        <figure style="width: 25%;">
            <img src="./outputs_simple/ncc/emir.jpg" alt="Error" style="width: 100%;">
            <figcaption>
                <p>Green X-Y Displacement: (15, 15)</p>
                <p>Red X-Y Displacement: (15, -5)</p>
                <p>Time Taken: 147.30 seconds</p>
            </figcaption>
        </figure>
        <figure style="width: 25%;">
            <img src="./outputs_simple/ncc/melons.jpg" alt="Error" style="width: 100%;">
            <figcaption>
                <p>Green Displacement: (15, 8)</p>
                <p>Red Displacement: (15, 15)</p>
                <p>Time Taken: 137.51 seconds</p>
            </figcaption>
        </figure>
    </div>

    <h2>Part 2: Pyramid Alignment</h2>
    <p style="text-align: left;">To speed up the runtime and improve alignment on larger image files, I implemented an image pyramid with multiple resolutions of the image, where each level was downsampled by a factor of 2. The pyramid included the original image as well as progressively downsampled versions for up to 5 levels. I then reduced the search window to a displacement range of -7 to 7 pixels in both the x and y directions. Using a recursive approach, I began alignment at the coarsest resolution with this smaller window. As the recursion moved to finer resolutions, I applied the same displacement window, but centered around the optimal displacement returned from the previous (coarser) level scaled appropriately to the new resolution. Similar to the naive approach, I evaluated alignments of the R and G plates with the B plate using both Euclidean distance and NCC, with the 10% crop added to each side of the plates before computing the scores.</p>
    
    <p style="text-align: left;">Below are several examples of images aligned using this method with NCC as the scoring metric. Note that the Emir image still shows some slight misalignment due to differences in brightness across the channels.</p>

    <div class="flex-center">
        <figure style="width: 25%;">
            <img src="./outputs_pyramid/ncc/cathedral.jpg" alt="Error" style="width: 100%;">
            <figcaption>
                <p>Green X-Y Displacement: (5, 2)</p>
                <p>Red X-Y Displacement: (12, 3)</p>
                <p>Time Taken: 0.38 seconds</p>
            </figcaption>
        </figure>
        <figure style="width: 25%;">
            <img src="./outputs_pyramid/ncc/church.jpg" alt="Error" style="width: 100%;">
            <figcaption>
                <p>Green X-Y Displacement: (25, 4)</p>
                <p>Red X-Y Displacement: (58, -4)</p>
                <p>Time Taken: 43.03 seconds</p>
            </figcaption>
        </figure>
        <figure style="width: 25%;">
            <img src="./outputs_pyramid/ncc/emir.jpg" alt="Error" style="width: 100%;">
            <figcaption>
                <p>Green X-Y Displacement: (49, 24)</p>
                <p>Red X-Y Displacement: (104, 56)</p>
                <p>Time Taken: 44.60 seconds</p>
            </figcaption>
        </figure>
    </div>

    <div class="flex-center">
        <figure style="width: 25%;">
            <img src="./outputs_pyramid/ncc/harvesters.jpg" alt="Error" style="width: 100%;">
            <figcaption>
                <p>Green X-Y Displacement: (60, 17)</p>
                <p>Red X-Y Displacement: (124, 13)</p>
                <p>Time Taken: 43.81 seconds</p>
            </figcaption>
        </figure>
        <figure style="width: 25%;">
            <img src="./outputs_pyramid/ncc/icon.jpg" alt="Error" style="width: 100%;">
            <figcaption>
                <p>Green X-Y Displacement: (41, 17)</p>
                <p>Red X-Y Displacement: (89, 23)</p>
                <p>Time Taken: 44.63 seconds</p>
            </figcaption>
        </figure>
        <figure style="width: 25%;">
            <img src="./outputs_pyramid/ncc/italil.jpg" alt="Error" style="width: 100%;">
            <figcaption>
                <p>Green X-Y Displacement: (38, 21)</p>
                <p>Red X-Y Displacement: (76, 35)</p>
                <p>Time Taken: 44.53 seconds</p>
            </figcaption>
        </figure>
    </div>

    <div class="flex-center">
        <figure style="width: 25%;">
            <img src="./outputs_pyramid/ncc/lastochikino.jpg" alt="Error" style="width: 100%;">
            <figcaption>
                <p>Green X-Y Displacement: (-3, -2)</p>
                <p>Red X-Y Displacement: (75, -9)</p>
                <p>Time Taken: 45.11 seconds</p>
            </figcaption>
        </figure>
        <figure style="width: 25%;">
            <img src="./outputs_pyramid/ncc/lugano.jpg" alt="Error" style="width: 100%;">
            <figcaption>
                <p>Green X-Y Displacement: (41, -16)</p>
                <p>Red X-Y Displacement: (93, -29)</p>
                <p>Time Taken: 45.80 seconds</p>
            </figcaption>
        </figure>
        <figure style="width: 25%;">
            <img src="./outputs_pyramid/ncc/melons.jpg" alt="Error" style="width: 100%;">
            <figcaption>
                <p>Green X-Y Displacement: (82, 11)</p>
                <p>Red X-Y Displacement: (178, 13)</p>
                <p>Time Taken: 44.83 seconds</p>
            </figcaption>
        </figure>
    </div>

    <div class="flex-center">
        <figure style="width: 25%;">
            <img src="./outputs_pyramid/ncc/monastery.jpg" alt="Error" style="width: 100%;">
            <figcaption>
                <p>Green X-Y Displacement: (-3, 2)</p>
                <p>Red X-Y Displacement: (3, 2)</p>
                <p>Time Taken: 0.38 seconds</p>
            </figcaption>
        </figure>
        <figure style="width: 25%;">
            <img src="./outputs_pyramid/ncc/self_portrait.jpg" alt="Error" style="width: 100%;">
            <figcaption>
                <p>Green X-Y Displacement: (79, 29)</p>
                <p>Red X-Y Displacement: (176, 37)</p>
                <p>Time Taken: 45.56 seconds</p>
            </figcaption>
        </figure>
        <figure style="width: 25%;">
            <img src="./outputs_pyramid/ncc/siren.jpg" alt="Error" style="width: 100%;">
            <figcaption>
                <p>Green X-Y Displacement: (49, -6)</p>
                <p>Red X-Y Displacement: (96, -25)</p>
                <p>Time Taken: 45.21 seconds</p>
            </figcaption>
        </figure>
    </div>

    <div class="flex-center">
        <figure style="width: 25%;">
            <img src="./outputs_pyramid/ncc/three_generations.jpg" alt="Error" style="width: 100%;">
            <figcaption>
                <p>Green X-Y Displacement: (53, 14)</p>
                <p>Red X-Y Displacement: (112, 11)</p>
                <p>Time Taken: 43.59 seconds</p>
            </figcaption>
        </figure>
        <figure style="width: 25%;">
            <img src="./outputs_pyramid/ncc/tobolsk.jpg" alt="Error" style="width: 100%;">
            <figcaption>
                <p>Green X-Y Displacement: (3, 3)</p>
                <p>Red X-Y Displacement: (6, 3)</p>
                <p>Time Taken: 0.38 seconds</p>
            </figcaption>
        </figure>
    </div>

    <h2>Part 3: Pyramid Alignment on Extra Images</h2>
    <p style="text-align: left;">Below are some extra images from the collection aligned using the Pyramid method with NCC as the scoring metric:</p>

    <div class="flex-center">
        <figure style="width: 25%;">
            <img src="./outputs_pyramid/ncc/peonies.jpg" alt="Error" style="width: 100%;">
            <figcaption>
                <p>Green X-Y Displacement: (51, 3)</p>
                <p>Red X-Y Displacement: (104, -6)</p>
                <p>Time Taken: 45.40 seconds</p>
            </figcaption>
        </figure>
        <figure style="width: 25%;">
            <img src="./outputs_pyramid/ncc/milan_cathedral.jpg" alt="Error" style="width: 100%;">
            <figcaption>
                <p>Green X-Y Displacement: (57, 12)</p>
                <p>Red X-Y Displacement: (125, 24)</p>
                <p>Time Taken: 47.23 seconds</p>
            </figcaption>
        </figure>
        <figure style="width: 25%;">
            <img src="./outputs_pyramid/ncc/mosque.jpg" alt="Error" style="width: 100%;">
            <figcaption>
                <p>Green X-Y Displacement: (25, 10)</p>
                <p>Red X-Y Displacement: (70, 11)</p>
                <p>Time Taken: 43.51 seconds</p>
            </figcaption>
        </figure>
    </div>

    <div class="flex-center">
        <figure style="width: 25%;">
            <img src="./outputs_pyramid/ncc/trinity_cathedral.jpg" alt="Error" style="width: 100%;">
            <figcaption>
                <p>Green X-Y Displacement: (39, 6)</p>
                <p>Red X-Y Displacement: (129, 12)</p>
                <p>Time Taken: 45.68 seconds</p>
            </figcaption>
        </figure>
        <figure style="width: 25%;">
            <img src="./outputs_pyramid/ncc/bashkir_dog.jpg" alt="Error" style="width: 100%;">
            <figcaption>
                <p>Green X-Y Displacement: (61, 8)</p>
                <p>Red X-Y Displacement: (138, 8)</p>
                <p>Time Taken: 45.77 seconds</p>
            </figcaption>
        </figure>
        <figure style="width: 25%;">
            <img src="./outputs_pyramid/ncc/crew.jpg" alt="Error" style="width: 100%;">
            <figcaption>
                <p>Green X-Y Displacement: (21, 18)</p>
                <p>Red X-Y Displacement: (56, 30)</p>
                <p>Time Taken: 44.46 seconds</p>
            </figcaption>
        </figure>
    </div>

</body>
</html>